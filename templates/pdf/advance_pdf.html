<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
  @page { size: letter; margin: 0.6in 0.55in 0.65in; }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: Arial, Helvetica, sans-serif; font-size: 8.5pt; color: #1a1a1a; line-height: 1.35; }

  /* ── Header ── */
  .doc-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 2.5px solid #000; }
  .doc-title { font-size: 18pt; font-weight: 900; letter-spacing: 0.05em; text-transform: uppercase; }
  .doc-title span { color: #B8840A; }
  .doc-org { font-size: 7pt; color: #555; text-transform: uppercase; letter-spacing: 0.08em; margin-top: 2px; }
  .doc-meta { text-align: right; font-size: 7.5pt; color: #444; }
  .doc-meta .version { font-size: 10pt; font-weight: bold; color: #B8840A; }

  /* ── Section ── */
  .section { margin-bottom: 8px; border: 1px solid #ccc; }
  .section-head { background: #1a1a1a; color: #fff; font-size: 7pt; font-weight: bold; letter-spacing: 0.1em; padding: 4px 7px; text-transform: uppercase; }
  .section-body { padding: 0; }

  /* ── Two-col layout ── */
  .two-col-table { width: 100%; border-collapse: collapse; }
  .two-col-table td { padding: 3.5px 7px; border-bottom: 1px solid #e8e8e8; vertical-align: top; }
  .two-col-table tr:last-child td { border-bottom: none; }
  .two-col-table .lbl { width: 40%; font-size: 7pt; font-weight: bold; color: #555; text-transform: uppercase; letter-spacing: 0.04em; white-space: nowrap; }
  .two-col-table .val { font-size: 8.5pt; color: #111; }

  /* ── Side-by-side sections ── */
  .side-by-side { display: flex; gap: 0; }
  .side-by-side .section { flex: 1; }
  .side-by-side .section:first-child { margin-right: 8px; }

  /* ── Notes block ── */
  .notes-val { white-space: pre-wrap; font-size: 8pt; color: #222; padding: 4px 7px; }

  /* ── Footer ── */
  .doc-footer { position: fixed; bottom: 0.35in; left: 0.55in; right: 0.55in; font-size: 6.5pt; color: #888; border-top: 1px solid #ddd; padding-top: 4px; display: flex; justify-content: space-between; }

  /* ── Checkbox indicator ── */
  .cb { display: inline-block; width: 9px; height: 9px; border: 1px solid #555; margin-right: 3px; vertical-align: middle; position: relative; }
  .cb.checked::after { content: '✓'; position: absolute; top: -2px; left: 0px; font-size: 8pt; font-weight: bold; color: #1a1a1a; }
</style>
</head>
<body>

{# ── Helpers ──────────────────────────────────────────────────── #}
{% macro row(label, value) %}
  {% set v = value|string|trim %}
  {% if v and v not in ['-','—','None','none','false',''] %}
  <tr>
    <td class="lbl">{{ label }}</td>
    <td class="val">{{ v }}</td>
  </tr>
  {% endif %}
{% endmacro %}

{% set d = advance_data %}
{% macro v(key, default='') %}{{ d.get(key, default)|string|trim }}{% endmacro %}

{# ── Document Header ──────────────────────────────────────────── #}
<div class="doc-header">
  <div style="display:flex;align-items:center;gap:12px">
    {% if logo_data %}
    <img src="{{ logo_data }}" alt="Logo" style="max-height:45px;max-width:120px;object-fit:contain">
    {% endif %}
    <div>
      <div class="doc-title">DPC <span>ADVANCE</span> SHEET</div>
      <div class="doc-org">Dr. Phillips Center for the Performing Arts</div>
    </div>
  </div>
  <div class="doc-meta">
    <div class="version">v{{ version }}</div>
    <div>{{ export_date }}</div>
    <div style="margin-top:3px; font-size:8pt; color:#222">
      <strong>{{ show.name }}</strong> &nbsp;·&nbsp; {{ show.show_date or '—' }}
    </div>
  </div>
</div>

{# ── Dynamic Sections ─────────────────────────────────────────── #}
{% if form_sections %}
  {% for section in form_sections %}
    {# Collect all non-empty values for this section #}
    {% set ns = namespace(has_content=false, notes_fields=[], regular_rows=[]) %}
    {% for field in section.fields %}
      {% set val = d.get(field.field_key, '')|string|trim %}
      {% if val and val not in ['-','—','None','none','false',''] %}
        {% set ns.has_content = true %}
      {% endif %}
      {% if field.is_notes_field %}
        {% set _ = ns.notes_fields.append(field) %}
      {% else %}
        {% set _ = ns.regular_rows.append(field) %}
      {% endif %}
    {% endfor %}

    {% if ns.has_content %}
    <div class="section">
      <div class="section-head">{{ section.label }}</div>
      {% if ns.regular_rows %}
      <table class="two-col-table">
        {% for field in ns.regular_rows %}
          {# Gracefully handle any field type — unknown types render as plain text #}
          {% set val = d.get(field.field_key, '')|string|trim %}
          {% if field.field_type == 'checkbox' %}
            {% if val == 'true' %}
            <tr>
              <td class="lbl"></td>
              <td class="val"><span class="cb checked"></span> {{ field.label }}</td>
            </tr>
            {% endif %}
          {% elif field.field_type == 'yes_no' %}
            {% if val and val not in ['','None','none'] %}
            <tr>
              <td class="lbl">{{ field.label }}</td>
              <td class="val">{{ val }}</td>
            </tr>
            {% endif %}
          {% elif val and val not in ['-','—','None','none','false',''] %}
          {# Handles: text, textarea, date, time, number, select, contact_dropdown, and any future types #}
          <tr>
            <td class="lbl">{{ field.label }}</td>
            <td class="val">{{ val }}</td>
          </tr>
          {% endif %}
        {% endfor %}
      </table>
      {% endif %}
      {% for field in ns.notes_fields %}
        {% set val = d.get(field.field_key, '')|string|trim %}
        {% if val and val not in ['None','none'] %}
        <div class="notes-val">{{ val }}</div>
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}
  {% endfor %}

{% else %}
  {# Fallback: hardcoded rendering if form_sections not passed #}

  <!-- Show Info + Contacts side by side -->
  <div class="side-by-side">
    <div class="section" style="flex:1.2">
      <div class="section-head">Show Information</div>
      <table class="two-col-table">
        {{ row('Show Name',  v('show_name', show.name)) }}
        {{ row('Date',       v('show_date', show.show_date or '')) }}
        {{ row('Time',       v('show_time', show.show_time)) }}
        {{ row('Venue',      v('venue',     show.venue)) }}
        {{ row('Prod. Manager', v('production_manager')) }}
        {{ row('Tour Manager',  v('tour_manager')) }}
        {{ row('Promoter',      v('promoter')) }}
        {{ row('Addl. Contacts',v('additional_contacts')) }}
      </table>
    </div>
    <div class="section" style="flex:1">
      <div class="section-head">Contacts &amp; Logistics</div>
      <table class="two-col-table">
        {{ row('Programming',    v('programming')) }}
        {{ row('Events',         v('events')) }}
        {{ row('Hospitality',    v('hospitality_contact')) }}
        {{ row('Guest Services', v('guest_services')) }}
        {{ row('Radio Channel',  v('radio_channel')) }}
        {{ row('Runner',         v('runner')) }}
        {{ row('Rental Works?',  v('rental_works')) }}
        {{ row('Budget — What',  v('budget_what')) }}
        {{ row('Budget — Amount',v('budget_amount')) }}
      </table>
    </div>
  </div>

{% endif %}

<!-- Footer -->
<div class="doc-footer">
  <span>{{ show.name }}  ·  {{ show.show_date or '—' }}</span>
  <span>ADVANCE SHEET v{{ version }}  ·  Exported {{ export_date }}</span>
  <span>Dr. Phillips Center for the Performing Arts</span>
</div>

</body>
</html>
